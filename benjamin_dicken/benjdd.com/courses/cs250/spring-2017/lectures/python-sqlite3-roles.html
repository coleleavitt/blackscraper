<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cs250</title>
  <link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet" href="/lib/highlight/styles/default.css">
  <script src="/lib/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Poppins:ital,wght@0,400;0,700;1,400;1,700&family=Questrial&family=Roboto+Flex:opsz,wdth,wght,YTDE@8..144,110,400,-230;8..144,110,700,-230&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <style>
  .lnp {
    font-size: 1.5em;
  }
  </style>

</head>
<body style="background-color: rgb(255, 255, 255)">
<script src="/js/theme.min.js"></script>

  <h1 id="csc-250-lecture-notes-implementing-roles-in-sqlite3">CSc 250: Lecture Notes: Implementing roles in sqlite3</h1>

<p>We previously implemented <code class="language-plaintext highlighter-rouge">getrole.py</code> and <code class="language-plaintext highlighter-rouge">addrole.py</code> is <a href="./python-file-io.html">the file io lecture notes</a>.
In those implementations, we used a text file to store the role information.
In this lecture, we will implement the same program, but we will use a sqlite3 database to store the relationships.
Review the linked notes if you forgot.</p>

<h2 id="creating-the-db">Creating the DB</h2>

<p>If you recall, the old implementation of <code class="language-plaintext highlighter-rouge">addrole.py</code> used a file formatted as follows to get role/actor info:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Han Solo       | Harrison Ford
Luke Skywalker | Mark Hamill
Batman         | Christian Bale
Thor           | Chris Hemsworth
Sherlock       | Benedict Cumberbatch
</code></pre></div></div>

<p>Instead, we will create a database to store this information.
Before using <code class="language-plaintext highlighter-rouge">sqlite3</code> to accomplish this, we need to create an empty database with the correct schema.</p>

<p>The first step is to open a bash shell and <code class="language-plaintext highlighter-rouge">cd</code> into the directory that you want the database file to be stored at.
One you are there run <code class="language-plaintext highlighter-rouge">sqlite3</code>, and create a table to store the mapping between roles and actors:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd
$ cd test/
$ sqlite3 roledb
SQLite version 3.14.0 2016-07-26 15:17:14
Enter ".help" for usage hints.
sqlite&gt; CREATE TABLE role (character_name TEXT, actor_name TEXT);
sqlite&gt; .exit
$
</code></pre></div></div>

<p>Only one table is needed to model this relationship, so this is all we need.</p>

<p>At this point, we should have a sqlite database file named roledb in this directory.
This database has the schema specified, but not data in it.</p>

<p>Next, let’s write a program that can add roles to this database.</p>

<h2 id="adding-a-role">Adding a role</h2>

<p>The first step is to import <code class="language-plaintext highlighter-rouge">sqlite3</code> and open a connection to the database:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sqlite3
conn = sqlite3.connect('roledb')
</code></pre></div></div>

<p>Next, we need to read in what roles need to be added to the database from the user.
This is similar to what we did in the last <code class="language-plaintext highlighter-rouge">addrole.py</code> implementation.
However, instead of writing the actor/character information to the text file, we must issue an <code class="language-plaintext highlighter-rouge">INSERT</code> command to the sqlite database to add the entry.
Also, when the <code class="language-plaintext highlighter-rouge">exit</code> command is written by a user, we must make sure to commit and close the database connection.
Putting it all together:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys
import sqlite3

conn = sqlite3.connect('roledb')

# Let the user add role/actor information to roles.txt until
# the exit command is given
while True:
    print ('PROGRAM: Add a role?')
    line = sys.stdin.readline().rstrip()
    sp = line.split('played')
    if line == 'exit':
        conn.commit()
        conn.close()
        sys.exit()
        print('PROGRAM: Bye!')
    elif len(sp) &gt; 1:
        actor = sp[0].strip()
        character = sp[1].strip()
        conn.execute("INSERT INTO role VALUES('" + character + "', '" + actor + "')")
        print('PROGRAM: Role added!')
    else:
        print('PROGRAM: Huh?')
</code></pre></div></div>

<p>This code can be saved into a file named <code class="language-plaintext highlighter-rouge">addrole.py</code>.
We can use this program to add a few entries to the roledb by running it from bash (or from IDLE):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 addrole.py 
PROGRAM: Add a role?
christian bale played batman
PROGRAM: Role added!
PROGRAM: Add a role?
chris hemsworth played thor
PROGRAM: Role added!
PROGRAM: Add a role?
henry cavill played superman
PROGRAM: Role added!
PROGRAM: Add a role?
exit
$ 
</code></pre></div></div>

<h2 id="getting-role-info">Getting Role Info</h2>

<p>Now, we’ll implement <code class="language-plaintext highlighter-rouge">getrole.py</code> - a program which will return role info by querying the SQL database.
Again, the first step is to import <code class="language-plaintext highlighter-rouge">sqlite3</code> and open a connection to the database:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sqlite3
conn = sqlite3.connect('roledb')
</code></pre></div></div>

<p>Next, we can execute a <code class="language-plaintext highlighter-rouge">SELECT</code> query to return all of the roles it knows about:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># SELECT all of the entries in the role table
result = conn.execute("SELECT * FROM role")
</code></pre></div></div>

<p>All of the query results are stored into the variable <code class="language-plaintext highlighter-rouge">results</code>.
From here, we can put all of the results into a dictionary, like we did when we previously read the info from a file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Create an empty map data structure representing the database of roles
# All of the movie roles will be stored here
roles = {}

# Populate the roles dictionary using the results of the SELECT query
for entry in result:
    character = entry[0]
    actor     = entry[1]
    roles[character] = actor
</code></pre></div></div>

<p>Once <code class="language-plaintext highlighter-rouge">roles</code> is populated with all role information, the rest of the program can work basically the same way it did before.
Putting it all together:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys
import sqlite3

# Connect to the sqlite database
import sqlite3
conn = sqlite3.connect('roledb')

# SELECT all of the entries in the role table
result = conn.execute("SELECT * FROM role")

# Create an empty map data structure representing the database of roles
# All of the movie roles will be stored here
roles = {}

# Populate the roles dictionary using the results of the SELECT query
for entry in result:
    character = entry[0]
    actor     = entry[1]
    roles[character] = actor

# Let the user get role/actor information in a loop
while True:
    print ('PROGRAM: What role would you like to know about?')
    line = sys.stdin.readline().rstrip()
    sp = line.split('tell me who played')
    
    if line == 'exit':
        print('PROGRAM: Bye!')
        sys.exit()
    elif len(sp) &gt; 1:
        role = sp[1].strip()
        if role in roles:
            print(roles[role] + ' played ' + role)
        else:
            print('PROGRAM: Not sure!')
    else:
        print('PROGRAM: Huh?')
</code></pre></div></div>

<p>With this program, we can query the entries added to the database via the <code class="language-plaintext highlighter-rouge">addrole.py</code> script.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 getrole.py 
PROGRAM: What role would you like to know about?
who played thor
PROGRAM: Huh?
PROGRAM: What role would you like to know about?
tell me who played thor
chris hemsworth played thor
PROGRAM: What role would you like to know about?
tell me who played batman
christian bale played batman
PROGRAM: What role would you like to know about?
exit
PROGRAM: Bye!
$
</code></pre></div></div>



<footer>
    <div>&nbsp</div>
    <div style="text-align:center;">	&copy; Benjamin Dicken 2016 - 2024 </div>
    <div>&nbsp</div>
</footer>

</body>
</html>
