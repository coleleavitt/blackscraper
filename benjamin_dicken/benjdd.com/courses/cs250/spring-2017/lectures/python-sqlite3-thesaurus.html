<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>cs250</title>
  <link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet" href="/lib/highlight/styles/default.css">
  <script src="/lib/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Poppins:ital,wght@0,400;0,700;1,400;1,700&family=Questrial&family=Roboto+Flex:opsz,wdth,wght,YTDE@8..144,110,400,-230;8..144,110,700,-230&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <style>
  .lnp {
    font-size: 1.5em;
  }
  </style>

</head>
<body style="background-color: rgb(255, 255, 255)">
<script src="/js/theme.min.js"></script>

  <h1 id="csc-250-lecture-notes-implementing-a-thesaurus-with-sqlite3">CSc 250: Lecture Notes: Implementing a thesaurus with sqlite3</h1>

<p><img src="/assets/memes/thesaurus-similar.jpg" width="200" /></p>

<p>We previously implemented <code class="language-plaintext highlighter-rouge">thesaurus.py</code> in <a href="./python-list-dict-io-review.html">these lecture notes</a>.
In that implementation, we used a text file to store the similar words and definitions.
We will implement the same program, but we will use a sqlite3 database.
Review the linked notes if you forgot how we did this before!</p>

<h2 id="creating-the-db">Creating the DB</h2>

<p>In the previous implementation of <code class="language-plaintext highlighter-rouge">thesaurus-db.txt</code>, we stored all of the information in a text file.
By the end of the lecture notes, the format of the file looked like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dark | having very little or no light | dim,dull,dusk
small | of limited size | tiny,little
happy | delighted, pleased, or glad, as over a particular thing | delighted,cheerful
fast | moving or able to move, operate, function, or take effect quickly | speedy,rapid,brisk
cheap | costing very little | bargain,economical
</code></pre></div></div>

<p>Each line has two vertical bars.
The word before the first vertical bar is the thesaurus word (the “initial” word).
The text between the first and second bar is the definition.
Then there is a list of comma-separated words after the second bar, which are the similar words.</p>

<p>We need to design a database schema to store this same information.
There are many ways to go about this, but we’ll start with a very simple design.</p>

<p>First, let’s <code class="language-plaintext highlighter-rouge">cd</code> to the desktop and startup/create a new database:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd
$ cd test/
$ sqlite3 thesdb
SQLite version 3.14.0 2016-07-26 15:17:14
Enter ".help" for usage hints.
sqlite&gt; 
</code></pre></div></div>

<p>Next, let’s create the schema.
We will design this database to have two tables.
One table will represent a <em>word</em>, and will include the word’s definition and a word id:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; CREATE TABLE word (word TEXT, definition TEXT, wid INT PRIMARY KEY);
</code></pre></div></div>

<p>Next, we will create a table to represent a word being similar to another word.
This will be a table with just two IDs.
Each ID will be a <code class="language-plaintext highlighter-rouge">FOREIGN KEY</code> into the word table, because it references words in that table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; CREATE TABLE similar (wid INT, sid INT, FOREIGN KEY (wid) REFERENCES word(wid), FOREIGN KEY (sid) REFERENCES word(wid));
</code></pre></div></div>

<p>This will be used to represent two words being “similar”.</p>

<h2 id="populating-the-db">Populating the DB</h2>

<p>Next, let’s populate this database to contain the same information that the text file did.
First, we’ll populate the <code class="language-plaintext highlighter-rouge">word</code> table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO word VALUES ('dark', 'having very little or no light', 1);
INSERT INTO word VALUES ('small', 'of limited size', 2);
INSERT INTO word VALUES ('happy', 'delighted, pleased, or glad, as over a particular thing', 3);
INSERT INTO word VALUES ('fast', 'moving or able to move, operate, function, or take effect quickly', 4);
INSERT INTO word VALUES ('cheap', 'costing very little', 5);
</code></pre></div></div>

<p>The next step is to populate the <code class="language-plaintext highlighter-rouge">similar</code> table to relate similar words to each-other.
However, the <code class="language-plaintext highlighter-rouge">similar</code> table only related words that are in the <code class="language-plaintext highlighter-rouge">word</code> table, so we need to add each similar word to the table also.
For expediency, we’ll not include the definitions.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO word VALUES ('dim', '', 6);
INSERT INTO word VALUES ('dull', '', 7);
INSERT INTO word VALUES ('tiny', '', 8);
INSERT INTO word VALUES ('little', '', 9);
INSERT INTO word VALUES ('delighted', '', 10);
INSERT INTO word VALUES ('cheerful', '', 11);
INSERT INTO word VALUES ('speedy', '', 12);
INSERT INTO word VALUES ('rapid', '', 13);
INSERT INTO word VALUES ('brisk', '', 14);
INSERT INTO word VALUES ('bargain', '', 15);
INSERT INTO word VALUES ('economical', '', 16);
</code></pre></div></div>

<p>Now the word table has the following contents:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; SELECT * FROM word;
dark|having very little or no light|1
small|of limited size|2
happy|delighted, pleased, or glad, as over a particular thing|3
fast|moving or able to move, operate, function, or take effect quickly|4
cheap|costing very little|5
dim||6
dull||7
tiny||8
little||9
delighted||10
cheerful||11
speedy||12
rapid||13
brisk||14
bargain||15
economical||16
</code></pre></div></div>

<p>Finally, we can add entries to the <code class="language-plaintext highlighter-rouge">similar</code> table using these IDs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT INTO similar VALUES (1, 6);
INSERT INTO similar VALUES (1, 7);
INSERT INTO similar VALUES (2, 8);
INSERT INTO similar VALUES (2, 9);
INSERT INTO similar VALUES (3, 10);
INSERT INTO similar VALUES (3, 11);
INSERT INTO similar VALUES (4, 12);
INSERT INTO similar VALUES (4, 13);
INSERT INTO similar VALUES (4, 14);
INSERT INTO similar VALUES (5, 15);
INSERT INTO similar VALUES (5, 16);
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; SELECT * FROM similar;
1|6
1|7
2|8
2|9
3|10
3|11
4|12
4|13
4|14
5|15
5|16
</code></pre></div></div>

<h2 id="how-to-get-similar-words">How to get similar words</h2>

<p>Because SQL is so flexible, getting all of the similar words for a given word can be done in many ways.
One technique is pretty straightforward, but is a multi-query process.</p>

<p>Say we want to find the words similar to “fast.”</p>

<p>First, we need to find the <code class="language-plaintext highlighter-rouge">wid</code> of “fast.”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; SELECT wid FROM word where word == 'fast';
4
</code></pre></div></div>

<p>Next, find the IDs of all the similar words.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; SELECT similar.sid FROM word JOIN similar on similar.wid == word.wid WHERE similar.wid == 4;
12
13
14
</code></pre></div></div>

<p>Finally, select the words with these ids from <code class="language-plaintext highlighter-rouge">word</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; SELECT word from word where wid == 12;
speedy
sqlite&gt; SELECT word from word where wid == 13;
rapid
sqlite&gt; SELECT word from word where wid == 14;
brisk
</code></pre></div></div>

<h2 id="the-implementation">The Implementation</h2>

<p>Here’s the python implementation, using the database and the queries we previously discussed.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>###
### Author: Benjamin Dicken
### Description:
###   This program acts as a thesaurus.
###   Is uses a SQLite thesaurus database to get the similar words.
###

import sys
import sqlite3

print('Welcome to the thesaurus!')
print('What word would you like to know about?')

word = sys.stdin.readline().strip()

conn = sqlite3.connect('thesdb')
r1 = conn.execute("SELECT wid FROM word WHERE word == '" + str(word) + "'")
wid = r1.fetchone()
if wid is not None:
    print('Similar word(s) to "' + word + '": ')
    sids = conn.execute("SELECT similar.sid FROM word JOIN similar on similar.wid == word.wid WHERE similar.wid == " + str(wid[0]))
    for sid in sids:
        r2 = conn.execute("SELECT word FROM word WHERE wid == " + str(sid[0]))
        word = r2.fetchone()
        print('  ' + str(word[0]))
else:
    print('Unable to find similar words to "' + word + '"')
</code></pre></div></div>

<p>And below are a few runs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 thesaurus.py
Welcome to the thesaurus!
What word would you like to know about?
fast
Similar word(s) to "fast":
  speedy
  rapid
  brisk
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 thesaurus.py
Welcome to the thesaurus!
What word would you like to know about?
dark
Similar word(s) to "dark":
  dim
  dull
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 thesaurus.py
Welcome to the thesaurus!
What word would you like to know about?
dinosoar
Unable to find similar words to "dinosoar"
</code></pre></div></div>



<footer>
    <div>&nbsp</div>
    <div style="text-align:center;">	&copy; Benjamin Dicken 2016 - 2024 </div>
    <div>&nbsp</div>
</footer>

</body>
</html>
