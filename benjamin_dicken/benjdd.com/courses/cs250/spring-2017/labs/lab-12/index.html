<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CSc 250 Lab 12</title>
  <link href="https://fonts.googleapis.com/css?family=Lato:900|Work+Sans" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet" href="/lib/highlight/styles/default.css">
  <script src="/lib/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Poppins:ital,wght@0,400;0,700;1,400;1,700&family=Questrial&family=Roboto+Flex:opsz,wdth,wght,YTDE@8..144,110,400,-230;8..144,110,700,-230&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

  <style>
  .lnp {
    font-size: 1.5em;
  }
  </style>

</head>
<body style="background-color: rgb(255, 255, 255)">
<script src="/js/theme.min.js"></script>

  <h1 id="csc-250-lab-12">CSc 250: Lab 12</h1>

<p><img src="/assets/memes/brace_yourself_sql.jpg" width="200" /></p>

<p>This lab was designed to be completed during lab-time for cs250.
This lab is not graded for correctness.
However, you should work through all of the problems, as it will help you on assignments and exams.
If you cannot complete the lab in the alloted time, finish at home.</p>

<p><strong>This particular lab was designed to be completed on the Mac lab machines in GS 930</strong></p>

<h2 id="problem-1">Problem 1</h2>

<p>Recall the banking example that was used in lecture this week.
I wrote a python program named <code class="language-plaintext highlighter-rouge">deposit.py</code> with the following code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys
import sqlite3

print('Welcome to the banking app!')
print('Enter a account ID to deposit money into:')
acct_id = sys.stdin.readline().strip()
print('Enter amount to deposit:')
dep = sys.stdin.readline().strip()

conn = sqlite3.connect('bankdb')
query = "UPDATE account SET balance = balance + " + dep + " WHERE acct_id == " + acct_id + ";"
res = conn.executescript(query)
conn.commit()
conn.close()
</code></pre></div></div>

<p>This program connects to a sqlite3 database named <code class="language-plaintext highlighter-rouge">bankdb</code>, which has the following schema:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE customer (
    first_name TEXT,
    last_name TEXT,
    uid INT PRIMARY KEY);
CREATE TABLE account (
    type TEXT,
    balance FLOAT,
    owner_uid INT,
    acct_id INT PRIMARY KEY,
    FOREIGN KEY (owner_uid) REFERENCES customer(uid));
</code></pre></div></div>

<p><strong>(A)</strong>
Come up with at least 10 total insert statements.
Insert at least 3 rows into <code class="language-plaintext highlighter-rouge">customer</code> and at least 7 into <code class="language-plaintext highlighter-rouge">account</code>.</p>

<p><strong>(B)</strong>
Run <code class="language-plaintext highlighter-rouge">deposit.py</code> a few times, and change the balances of a multiple accounts.</p>

<p><strong>(C)</strong>
Use SQL Injection to add $1,000,000 to one of the accounts.</p>

<p><strong>(D)</strong>
Use SQL Injection to delete one of the accounts from the <code class="language-plaintext highlighter-rouge">account</code> table.</p>

<p><strong>(E)</strong>
Use SQL Injection to change the first/last name of one of the <em>existing</em> customers to Jiminy Cricket.</p>

<p><strong>(F)</strong>
What would happen if a user typed <code class="language-plaintext highlighter-rouge">1 OR acct_id != 1 ; --</code> as the first input (<code class="language-plaintext highlighter-rouge">acct_id</code>) to <code class="language-plaintext highlighter-rouge">deposit.py</code>?
First, come up with what you think would happen in your head.
Then, try it out and take a peek at the database afterward.</p>

<p><strong>(G)</strong>
Fix this script so that it is no longer vulnerable to SQL injection.
Once you’ve made the fix, try out the above SQL injection “attacks” to make sure they no longer work.</p>

<h2 id="problem-2">Problem 2</h2>

<p><img src="/assets/memes/import-csv.jpg" width="200" /></p>

<p><a href="https://vincentarelbundock.github.io/Rdatasets/datasets.html">This neat website</a> has links to hundreds of interesting and unique CSV data sets.
Use this site for this problem.</p>

<p><strong>(A)</strong>
Browse through the aforementioned site and find a data set that looks interesting to you.
Once found, click the “CSV” link to download the data as CSV.
Open the file up in a text editor, such as atom.
Make sure that the first row of the CSV file has the names of the columns.
If not, add them in manually.</p>

<p><strong>(B)</strong>
Create a new (empty) SQLite database named <code class="language-plaintext highlighter-rouge">lab12-2</code>.
Using the techniques discussed in lecture this week, load this data file into a new table.</p>

<p><strong>(C)</strong>
Type <code class="language-plaintext highlighter-rouge">.schema</code>.
You’ll probably notice that all of the columns in the table are of type <code class="language-plaintext highlighter-rouge">TEXT</code>.
Depending on the data set you chose, this probably not what you want, because some of them would likely be integer or float values.
Delete the table (using <code class="language-plaintext highlighter-rouge">DROP TABLE</code>).</p>

<p><strong>(D)</strong>
Open up the CSV file and get rid of the first row with the names of the columns.
Then go back to your SQL session, manually create a more accurate schema for the data, and re-load the file.</p>

<h2 id="problem-3">Problem 3</h2>

<p>For this problem, download the <a href="https://vincentarelbundock.github.io/Rdatasets/csv/Ecdat/Diamond.csv">Diamond CSV data set</a>.
You will first load this data into a table in a SQLite database, and then you will use the <em>aggregate</em> functions discussed in lecture to compute some values.</p>

<p><strong>(A)</strong></p>

<ul>
  <li>Create a new SQLite database named <code class="language-plaintext highlighter-rouge">diamonddb</code>.</li>
  <li>Write a <code class="language-plaintext highlighter-rouge">CREATE TABLE ...</code> statement to create a table named <code class="language-plaintext highlighter-rouge">diamond</code> that this CSV file will be loaded into.
Make sure to give each column an appropriate type.</li>
  <li>Remove the first row of <code class="language-plaintext highlighter-rouge">Diamond.csv</code> (the row with the column titles)</li>
  <li>Use <code class="language-plaintext highlighter-rouge">.import</code> to load this CSV file into the <code class="language-plaintext highlighter-rouge">diamond</code> table</li>
</ul>

<p><strong>(B)</strong>
Write a <code class="language-plaintext highlighter-rouge">SELECT</code> statement that computes the <em>average</em> price of all diamonds in the table.</p>

<p><strong>(C)</strong>
Write a <code class="language-plaintext highlighter-rouge">SELECT</code> statement that returns the cheapest diamond in the whole table.</p>

<p><strong>(D)</strong>
Write a <code class="language-plaintext highlighter-rouge">SELECT</code> statement that returns the largest diamond (the most carats) whose color is <code class="language-plaintext highlighter-rouge">'E'</code> and clarity is <code class="language-plaintext highlighter-rouge">IF</code>.</p>

<p><strong>(E)</strong>
Write a <code class="language-plaintext highlighter-rouge">SELECT</code> statement that counts the number of diamonds that cost less than 3000 dollars.</p>

<p><strong>(F)</strong>
Write a <code class="language-plaintext highlighter-rouge">SELECT</code> statement that computes the average size (in carats) of diamonds costing more than 7000 dollars.</p>



<footer>
    <div>&nbsp</div>
    <div style="text-align:center;">	&copy; Benjamin Dicken 2016 - 2024 </div>
    <div>&nbsp</div>
</footer>

</body>
</html>
